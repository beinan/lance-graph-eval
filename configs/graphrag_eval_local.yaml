benchmark:
  name: graphrag_eval_v1
  runs: 30
  warmups: 5
  concurrency: 4
  timeout_s: 30
  seed: 42
  output_dir: results
  metadata:
    cache_policy: warm cache after warmups; no manual cache drops
    vector_dimension: 32
    distance_metric: cosine
    index_params:
      neo4j:
        index: vector
        params:
          vector.dimensions: 32
          vector.similarity_function: cosine
      kuzu:
        index: hnsw
        params:
          m: 16
          ef_construction: 200
          ef_search: 100
      lance_graph:
        index: ivf_pq
        params:
          nlist: 1024
          pq_m: 16
          nprobe: 32
datasets:
- name: graphrag_bench_medical
  path: /home/user/p/lance-graph-eval/datasets/graph/graphrag_bench_medical
  notes: Converted from GraphRAG-Bench medical corpus
engines:
- name: kuzu_local
  kind: kuzu
  options:
    path: /home/user/p/lance-graph-eval/datasets/kuzu_medical.db
    threadsafe: false
- name: lance_graph_local
  kind: lance_graph
  options:
    mode: datasets
    datasets_dir: /home/user/p/lance-graph-eval/datasets/graph/graphrag_bench_medical/parquet
    tables:
      Document: documents.parquet
      Chunk: chunks.parquet
      Entity: entities.parquet
      Community: communities.parquet
      edges: edges.parquet
    graph:
      nodes:
      - label: Document
        id_field: id
      - label: Chunk
        id_field: id
      - label: Entity
        id_field: id
      - label: Community
        id_field: id
      relationships:
      - name: HAS_CHUNK
        src_field: src_id
        dst_field: dst_id
        from_edges: edges
      - name: MENTIONS
        src_field: src_id
        dst_field: dst_id
        from_edges: edges
      - name: PARENT_OF
        src_field: src_id
        dst_field: dst_id
        from_edges: edges
    threadsafe: false
setup: []
queries:
- name: hybrid_search
  tags:
  - hybrid
  - vector
  - traversal
  params: {}
  expect:
    min_rows: 1
  fetch: scalar
  texts:
    neo4j: 'CALL db.index.vector.queryNodes(''chunk_embedding'', $top_k, $embedding)

      YIELD node, score

      MATCH (node)-[:MENTIONS]->(e:Entity)

      RETURN count(*) AS n

      '
    kuzu: MATCH (c:Chunk)-[:MENTIONS]->(e:Entity) RETURN count(*) AS n
    lance_graph: MATCH (c:Chunk)-[:MENTIONS]->(e:Entity) RETURN count(*) AS n
- name: local_search_2hop
  tags:
  - local
  - traversal
  params:
    entity_name: About
  expect:
    min_rows: 1
  fetch: scalar
  texts:
    neo4j: 'CALL db.index.fulltext.queryNodes(''entity_name'', $entity_name) YIELD
      node

      MATCH (node)-[r*1..2]->(n)

      WHERE ALL(rel IN r WHERE type(rel) <> ''MENTIONS'')

      RETURN count(*) AS n

      '
    kuzu: 'MATCH (e:Entity {name: $entity_name})<-[:MENTIONS]-(c:Chunk)-[:PARENT_OF]->(d:Document)
      RETURN count(*) AS n'
    lance_graph: 'MATCH (e:Entity {name: $entity_name})<-[:MENTIONS]-(c:Chunk)-[:PARENT_OF]->(d:Document)
      RETURN count(*) AS n'
- name: parent_child_enrichment
  tags:
  - context
  - parent
  params: {}
  expect:
    min_rows: 1
  fetch: scalar
  texts:
    neo4j: 'CALL db.index.vector.queryNodes(''chunk_embedding'', $top_k, $embedding)

      YIELD node

      MATCH (node)-[:PARENT_OF]->(p:Document)

      RETURN count(*) AS n

      '
    kuzu: MATCH (c:Chunk)-[:PARENT_OF]->(p:Document) RETURN count(*) AS n
    lance_graph: MATCH (c:Chunk)-[:PARENT_OF]->(p:Document) RETURN count(*) AS n
- name: global_search
  tags:
  - global
  - aggregation
  params:
    level: 1
  expect:
    min_rows: 1
  fetch: scalar
  texts:
    neo4j: 'MATCH (c:Community {level: $level})

      RETURN count(*) AS n

      '
    kuzu: 'MATCH (c:Community {level: $level}) RETURN count(*) AS n'
    lance_graph: 'MATCH (c:Community {level: $level})

      RETURN count(*) AS n'
